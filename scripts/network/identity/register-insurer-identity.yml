#
# SPDX-License-Identifier: Apache-2.0
#
---
  - name: Register insurer identity
    hosts: localhost
    vars_files:
      - ../vars/common.yml
      - ../vars/insurer-org.yml
    tasks:
      - name: Register a new insurer identity
        ibm.blockchain_platform.registered_identity:
          api_endpoint: "{{ api_endpoint }}"
          api_authtype: "{{ api_authtype }}"
          api_key: "{{ api_key }}"
          api_secret: "{{ api_secret | default(omit) }}"
          api_token_endpoint: "{{ api_token_endpoint | default(omit) }}"
          certificate_authority: "{{ insurer_ca_name }}"
          registrar: "../output/{{insurer_name}}/CA Admin.json"
          enrollment_id: "{{ enrollment_id }}"
          enrollment_secret: "{{ enrollment_secret }}"
          max_enrollments: "{{ max_enrollments }}"
          type: "{{ enrollment_type }}"
          attributes:
            - name: "vehicle_manufacture.username"
              value: "{{ enrollment_id }}@{{ manufacturer_name }}"
              ecert: true
            "{{ attributes }}"
